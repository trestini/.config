"use strict";var w=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var R=(o,t)=>{for(var i in t)w(o,i,{get:t[i],enumerable:!0})},U=(o,t,i,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of O(t))!B.call(o,s)&&s!==i&&w(o,s,{get:()=>t[s],enumerable:!(d=W(t,s))||d.enumerable});return o};var _=o=>U(w({},"__esModule",{value:!0}),o);var z={};R(z,{default:()=>S});module.exports=_(z);var p=require("react"),r=require("@raycast/api");var x=require("child_process"),v=require("util");var F=require("@raycast/api"),J=(0,v.promisify)(x.exec),j=(0,F.getPreferenceValues)().taskPath;var rt=`${j} export rc.json.array:on`;var E=async(o,t,i,d,s,n)=>{let e=[`${j}`];o?e.push("modify",o):e.push("add"),typeof t<"u"&&e.push(`"${t}"`),typeof i<"u"&&(i!==""?e.push(`project:"${i}"`):e.push("project:")),typeof d<"u"&&e.push(...d),typeof s<"u"&&e.push(`due:${s}`),typeof n<"u"&&(n?e.push(`priority:${n}`):e.push("priority:"));let l=e.join(" ");try{let{stderr:g}=await J(l);if(g.includes("not a valid date"))throw new Error("Invalid due date format. Use the Y-M-D format or Taskwarrior format")}catch(g){throw new Error(`Error in modifyTask function. ${g}`)}};function Z(o){let t=o.substring(0,4),i=o.substring(4,6),d=o.substring(6,8),s=o.substring(9,11),n=o.substring(11,13),e=o.substring(13,15),l=`${t}-${i}-${d}T${s}:${n}:${e}Z`;return new Date(l)}var A=o=>{let t=Z(o),i=n=>{let e=new Date;return n.getDate()===e.getDate()&&n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear()},d=n=>{let e=new Date;return e.setDate(e.getDate()+1),n.getDate()===e.getDate()&&n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear()},s=n=>{let e=n.getHours(),l=n.getMinutes(),g=e>=12?"PM":"AM";return`${(e+11)%12+1}:${l.toString().padStart(2,"0")} ${g}`};return i(t)?`Today at ${s(t)}`:d(t)?`Tomorrow at ${s(t)}`:`${t.toLocaleDateString()} at ${s(t)}`};var c=require("react/jsx-runtime"),q=o=>{let{task:t}=o,i=a=>{switch(a){case"H":return"High";case"M":return"Medium";case"L":return"Low";default:return"None"}},d=a=>{switch(a){case"High":return"H";case"Medium":return"M";case"Low":return"L";case"None":return"";default:return}},[s,n]=(0,p.useState)(),[e,l]=(0,p.useState)(),[g,D]=(0,p.useState)(),T=t.due?A(t.due):void 0,[k,H]=(0,p.useState)(i(t.priority)),$=()=>{s&&s.length>0&&n(void 0)},M=()=>{e&&e.length>0&&l(void 0)},L=()=>{g&&g.length>0&&D(void 0)},I=a=>Array.from(a).map(u=>u.startsWith("+")||u.startsWith("-")?u:`+${u}`).join(","),V=(a,u)=>{let f=!0;return(!a||a.trim().length===0)&&(n("A task must at least have a description."),f=!1),u&&u.includes(" ")&&(l("spaces are not allowed. format: tag1,tag2,tag3"),f=!1),u&&u.split(",").filter(m=>!m.startsWith("+")&&!m.startsWith("-")).length>0&&(l("Tags should start with + or -. Format: +tag1,-tag2,+tag3"),f=!1),f},N=async({description:a,project:u,tags:f,due:y})=>{if(!V(a,f))return;let P=f?.split(","),m=y===T?void 0:y,C=d(k);try{await E(t.uuid,a,u,P,m,C),(0,r.showToast)({title:"Modified Task successfully",style:r.Toast.Style.Success}),(0,r.popToRoot)()}catch(h){h instanceof Error&&h.message.includes("not a valid date")?D("Invalid due date format. Use the 'Y-M-D' format or Taskwarrior shorthand."):(console.error(h),(0,r.showToast)({title:`Error modifying task: ${h}`,style:r.Toast.Style.Failure}))}};return(0,c.jsxs)(r.Form,{actions:(0,c.jsx)(r.ActionPanel,{children:(0,c.jsx)(r.Action.SubmitForm,{onSubmit:N})}),children:[(0,c.jsx)(r.Form.TextField,{id:"description",title:"Description",placeholder:"task description",defaultValue:t.description,error:s,onChange:$,onBlur:a=>{a.target.value?.length==0?n("A task must at least have a description."):$()}},"description"),(0,c.jsx)(r.Form.TextField,{id:"project",title:"Project",placeholder:"project name",defaultValue:t.project?t.project:"",info:"leave empty to delete or not add a new project"},"project"),(0,c.jsx)(r.Form.TextField,{id:"tags",title:"Tags",placeholder:"-tag1,+tag2,+tag3",defaultValue:t.tags?I(t.tags):"",info:"add comma saparated list of tags. +tag to add and -tag to remove",error:e,onChange:M,onBlur:a=>{a.target.value?.includes(" ")?l("spaces are not allowed. format: tag1,tag2,tag3"):M()}}),(0,c.jsx)(r.Form.TextField,{id:"due",title:"Due Date",placeholder:"Y-M-D or Taskwarrior shorthand",defaultValue:T,info:"Enter due date in Y-M-D format or Taskwarrior shorthand (e.g., 'today', 'tomorrow', '+3d', '+1w')",error:g,onChange:L}),(0,c.jsxs)(r.Form.Dropdown,{id:"priority",title:"Priority",value:k,onChange:H,children:[(0,c.jsx)(r.Form.Dropdown.Item,{value:"High",title:"High"}),(0,c.jsx)(r.Form.Dropdown.Item,{value:"Medium",title:"Medium"}),(0,c.jsx)(r.Form.Dropdown.Item,{value:"Low",title:"Low"}),(0,c.jsx)(r.Form.Dropdown.Item,{value:"None",title:"None"})]})]})},b=q;var Y=require("react/jsx-runtime");function S(){return(0,Y.jsx)(b,{task:{uuid:"",description:"",entry:"",status:"",urgency:0,priority:void 0,project:"",tags:new Set,due:""}})}
