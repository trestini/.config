"use strict";var B=Object.defineProperty;var at=Object.getOwnPropertyDescriptor;var it=Object.getOwnPropertyNames;var ct=Object.prototype.hasOwnProperty;var dt=(r,t)=>{for(var i in t)B(r,i,{get:t[i],enumerable:!0})},ut=(r,t,i,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of it(t))!ct.call(r,n)&&n!==i&&B(r,n,{get:()=>t[n],enumerable:!(c=at(t,n))||c.enumerable});return r};var lt=r=>ut(B({},"__esModule",{value:!0}),r);var Dt={};dt(Dt,{default:()=>wt});module.exports=lt(Dt);var l=require("@raycast/api"),j=require("react");var G=require("child_process"),_=require("util");var J=require("@raycast/api"),E=(0,_.promisify)(G.exec),F=(0,J.getPreferenceValues)().taskPath,gt=`Configuration override rc.json.array:on
`,ft=`${F} export rc.json.array:on`,Z=async()=>{let r=[];try{let{stdout:t,stderr:i}=await E(ft,{maxBuffer:1e6});if(i&&i!==gt)throw new Error("please make sure you have set the path to task in the extension settings");let c=JSON.parse(t);c&&(r=c.sort((n,o)=>o.urgency-n.urgency))}catch{throw new Error("Please make sure you have set the path to task in the settings")}return r};var O=async()=>(await Z()).filter(t=>t.status==="pending"),q=async r=>(await Z()).filter(i=>i.project===r&&i.status==="pending");var b=async r=>{try{let{stderr:t}=await E(`${F} delete ${r} rc.confirmation:off`);t&&console.error(t)}catch(t){throw new Error(`error in deleteTask function: "${t}"`)}},C=async r=>{try{let{stderr:t}=await E(`${F} ${r} done`);t&&console.error(t)}catch(t){throw new Error(`error in markTaskAsDone function: "${t}"`)}},A=async(r,t,i,c,n,o)=>{let e=[`${F}`];r?e.push("modify",r):e.push("add"),typeof t<"u"&&e.push(`"${t}"`),typeof i<"u"&&(i!==""?e.push(`project:"${i}"`):e.push("project:")),typeof c<"u"&&e.push(...c),typeof n<"u"&&e.push(`due:${n}`),typeof o<"u"&&(o?e.push(`priority:${o}`):e.push("priority:"));let p=e.join(" ");try{let{stderr:d}=await E(p);if(d.includes("not a valid date"))throw new Error("Invalid due date format. Use the Y-M-D format or Taskwarrior format")}catch(d){throw new Error(`Error in modifyTask function. ${d}`)}};var z=async()=>{let r=await O(),t=new Set;return r.forEach(i=>{i.project&&t.add(i.project)}),t.add("All"),t};var Y=require("@raycast/api"),x=require("react/jsx-runtime"),mt=r=>{let{projects:t,onProjectChange:i}=r;return(0,x.jsxs)(Y.List.Dropdown,{tooltip:"Select Project",storeValue:!0,defaultValue:"All",onChange:c=>{i(c)},children:[Array.from(t).map(c=>(0,x.jsx)(Y.List.Dropdown.Item,{title:c,value:c},c)),(0,x.jsx)(Y.List.Dropdown.Section,{title:"Projects"})]})},K=mt;var tt=require("react"),a=require("@raycast/api");function R(r){let t=r.substring(0,4),i=r.substring(4,6),c=r.substring(6,8),n=r.substring(9,11),o=r.substring(11,13),e=r.substring(13,15),p=`${t}-${i}-${c}T${n}:${o}:${e}Z`;return new Date(p)}var U=r=>{let t=R(r),i=o=>{let e=new Date;return o.getDate()===e.getDate()&&o.getMonth()===e.getMonth()&&o.getFullYear()===e.getFullYear()},c=o=>{let e=new Date;return e.setDate(e.getDate()-1),o.getDate()===e.getDate()&&o.getMonth()===e.getMonth()&&o.getFullYear()===e.getFullYear()},n=o=>{let e=o.getHours(),p=o.getMinutes(),d=e>=12?"PM":"AM";return`${(e+11)%12+1}:${p.toString().padStart(2,"0")} ${d}`};return i(t)?`Today at ${n(t)}`:c(t)?`Yesterday at ${n(t)}`:t.toLocaleDateString()+" at "+n(t)},Q=r=>{let t=R(r),i=new Date,c=60*1e3,n=c*60,o=n*24,e=o*30,p=o*365,d=i.getTime()-t.getTime();if(d<c){let g=Math.round(d/1e3);return`${g} second${g!==1?"s":""}`}else if(d<n){let g=Math.round(d/c);return`${g} minute${g!==1?"s":""}`}else if(d<o){let g=Math.round(d/n);return`${g} hour${g!==1?"s":""}`}else if(d<e){let g=Math.round(d/o);return`${g} day${g!==1?"s":""}`}else if(d<p){let g=Math.round(d/e);return`${g} month${g!==1?"s":""}`}else{let g=Math.round(d/p);return`${g} year${g!==1?"s":""}`}},H=r=>{let t=R(r),i=o=>{let e=new Date;return o.getDate()===e.getDate()&&o.getMonth()===e.getMonth()&&o.getFullYear()===e.getFullYear()},c=o=>{let e=new Date;return e.setDate(e.getDate()+1),o.getDate()===e.getDate()&&o.getMonth()===e.getMonth()&&o.getFullYear()===e.getFullYear()},n=o=>{let e=o.getHours(),p=o.getMinutes(),d=e>=12?"PM":"AM";return`${(e+11)%12+1}:${p.toString().padStart(2,"0")} ${d}`};return i(t)?`Today at ${n(t)}`:c(t)?`Tomorrow at ${n(t)}`:`${t.toLocaleDateString()} at ${n(t)}`};var S=require("react"),f=require("@raycast/api");var k=require("react/jsx-runtime"),yt=r=>{let{task:t}=r,i=h=>{switch(h){case"H":return"High";case"M":return"Medium";case"L":return"Low";default:return"None"}},c=h=>{switch(h){case"High":return"H";case"Medium":return"M";case"Low":return"L";case"None":return"";default:return}},[n,o]=(0,S.useState)(),[e,p]=(0,S.useState)(),[d,g]=(0,S.useState)(),u=t.due?H(t.due):void 0,[w,s]=(0,S.useState)(i(t.priority)),T=()=>{n&&n.length>0&&o(void 0)},M=()=>{e&&e.length>0&&p(void 0)},N=()=>{d&&d.length>0&&g(void 0)},rt=h=>Array.from(h).map(D=>D.startsWith("+")||D.startsWith("-")?D:`+${D}`).join(","),ot=(h,D)=>{let P=!0;return(!h||h.trim().length===0)&&(o("A task must at least have a description."),P=!1),D&&D.includes(" ")&&(p("spaces are not allowed. format: tag1,tag2,tag3"),P=!1),D&&D.split(",").filter(v=>!v.startsWith("+")&&!v.startsWith("-")).length>0&&(p("Tags should start with + or -. Format: +tag1,-tag2,+tag3"),P=!1),P},st=async({description:h,project:D,tags:P,due:V})=>{if(!ot(h,P))return;let W=P?.split(","),v=V===u?void 0:V,nt=c(w);try{await A(t.uuid,h,D,W,v,nt),(0,f.showToast)({title:"Modified Task successfully",style:f.Toast.Style.Success}),(0,f.popToRoot)()}catch(L){L instanceof Error&&L.message.includes("not a valid date")?g("Invalid due date format. Use the 'Y-M-D' format or Taskwarrior shorthand."):(console.error(L),(0,f.showToast)({title:`Error modifying task: ${L}`,style:f.Toast.Style.Failure}))}};return(0,k.jsxs)(f.Form,{actions:(0,k.jsx)(f.ActionPanel,{children:(0,k.jsx)(f.Action.SubmitForm,{onSubmit:st})}),children:[(0,k.jsx)(f.Form.TextField,{id:"description",title:"Description",placeholder:"task description",defaultValue:t.description,error:n,onChange:T,onBlur:h=>{h.target.value?.length==0?o("A task must at least have a description."):T()}},"description"),(0,k.jsx)(f.Form.TextField,{id:"project",title:"Project",placeholder:"project name",defaultValue:t.project?t.project:"",info:"leave empty to delete or not add a new project"},"project"),(0,k.jsx)(f.Form.TextField,{id:"tags",title:"Tags",placeholder:"-tag1,+tag2,+tag3",defaultValue:t.tags?rt(t.tags):"",info:"add comma saparated list of tags. +tag to add and -tag to remove",error:e,onChange:M,onBlur:h=>{h.target.value?.includes(" ")?p("spaces are not allowed. format: tag1,tag2,tag3"):M()}}),(0,k.jsx)(f.Form.TextField,{id:"due",title:"Due Date",placeholder:"Y-M-D or Taskwarrior shorthand",defaultValue:u,info:"Enter due date in Y-M-D format or Taskwarrior shorthand (e.g., 'today', 'tomorrow', '+3d', '+1w')",error:d,onChange:N}),(0,k.jsxs)(f.Form.Dropdown,{id:"priority",title:"Priority",value:w,onChange:s,children:[(0,k.jsx)(f.Form.Dropdown.Item,{value:"High",title:"High"}),(0,k.jsx)(f.Form.Dropdown.Item,{value:"Medium",title:"Medium"}),(0,k.jsx)(f.Form.Dropdown.Item,{value:"Low",title:"Low"}),(0,k.jsx)(f.Form.Dropdown.Item,{value:"None",title:"None"})]})]})},I=yt;var X=require("react/jsx-runtime");function $(){return(0,X.jsx)(I,{task:{uuid:"",description:"",entry:"",status:"",urgency:0,priority:void 0,project:"",tags:new Set,due:""}})}var m=require("react/jsx-runtime"),ht=r=>{let t=Math.floor(Math.random()*r.length);return r[t]},kt=r=>{let{task:t}=r,i=Object.values(a.Color).filter(u=>u!==a.Color.PrimaryText&&u!==a.Color.SecondaryText),c=u=>{let w=new Map,s=[...i];return u.forEach(T=>{s.length===0&&s.push(...i);let M=ht(s);w.set(T,M);let N=s.indexOf(M);s.splice(N,1)}),w},n=(0,tt.useMemo)(()=>c(t.tags?[...t.tags]:[]),[t.tags]),o=async(u,w,s)=>{await(0,a.showToast)({title:u,style:w,message:s})},e=async u=>{await C(u),o("Success",a.Toast.Style.Success,"Task marked as done"),(0,a.popToRoot)()},p=async u=>{await b(u),o("Success",a.Toast.Style.Success,"Task Deleted"),(0,a.popToRoot)()},d=u=>{switch(u){case"High":return"H";case"Medium":return"M";case"Low":return"L";case"None":return"";default:return}},g=async u=>{let w=u.tags&&Array.from(u.tags).includes("next")?"-next":"+next";A(u.uuid,void 0,void 0,[w]),(0,a.popToRoot)()};return(0,m.jsx)(a.Detail,{navigationTitle:t.description,markdown:`# ${t.description}`,actions:(0,m.jsxs)(a.ActionPanel,{children:[(0,m.jsx)(a.Action.Push,{title:"Modify",target:(0,m.jsx)(I,{task:t})},"Modify"),(0,m.jsx)(a.Action,{title:"Mark as Done",onAction:()=>e(t.uuid)}),(0,m.jsx)(a.Action,{title:"Delete",shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>p(t.uuid)},"delete"),(0,m.jsx)(a.Action,{title:t.tags&&Array.from(t.tags).includes("next")?"Stop":"Start",shortcut:{modifiers:["ctrl"],key:"s"},onAction:()=>g(t)},"start"),(0,m.jsx)(a.Action.Push,{title:"Add New Task",target:(0,m.jsx)($,{}),shortcut:{modifiers:["cmd"],key:"n"}},"new")]}),metadata:(0,m.jsxs)(a.Detail.Metadata,{children:[(0,m.jsx)(a.Detail.Metadata.Label,{title:"Status:",text:t.status},"status"),t.project?(0,m.jsx)(a.Detail.Metadata.Label,{title:"Project:",text:t.project},"project"):"",t.priority?(0,m.jsx)(a.Detail.Metadata.Label,{title:"Priority:",text:d(t.priority)},"priority"):"",t.due?(0,m.jsx)(a.Detail.Metadata.Label,{title:"due:",text:H(t.due)},"due"):"",(0,m.jsx)(a.Detail.Metadata.Label,{title:"Urgency:",text:t.urgency.toLocaleString()},"Urgency"),t.start?(0,m.jsx)(a.Detail.Metadata.Label,{title:"Active for:",text:Q(t.start)},"start"):"",t.entry?(0,m.jsx)(a.Detail.Metadata.Label,{title:"Added on:",text:U(t.entry)},"entry"):"",t.modified?(0,m.jsx)(a.Detail.Metadata.Label,{title:"Modified on:",text:U(t.modified)},"modified"):"",t.tags?(0,m.jsx)(a.Detail.Metadata.TagList,{title:"tags",children:Array.from(t.tags).map(u=>(0,m.jsx)(a.Detail.Metadata.TagList.Item,{text:u,color:n.get(u)||a.Color.Blue},u))},"TagsList"):""]})})},et=kt;var y=require("react/jsx-runtime"),Tt=()=>{let[r,t]=(0,j.useState)([]),[i,c]=(0,j.useState)(new Set([]));(0,j.useEffect)(()=>{o(),e()},[]);let n=async(s,T,M)=>{await(0,l.showToast)({title:s,style:T,message:M})},o=async()=>{try{let s=await O();t(s)}catch(s){n("Error",l.Toast.Style.Failure,`${s}`),(0,l.popToRoot)()}},e=async()=>{try{let s=await z();c(s)}catch(s){n("Error",l.Toast.Style.Failure,`${s}`)}},p=async s=>{if(s==="All")o();else try{console.log(`project changed to ${s}`);let T=await q(s);console.log(T),t(T)}catch(T){n("Error",l.Toast.Style.Failure,`${T}`)}},d=async s=>{await C(s),o(),n("Success",l.Toast.Style.Success,"Task marked as done")},g=s=>{p(s)},u=async s=>{await b(s),o(),n("Success",l.Toast.Style.Success,"Task Deleted")},w=async s=>{let T=s.tags&&Array.from(s.tags).includes("next")?"-next":"+next";await A(s.uuid,void 0,void 0,[T]),o()};return(0,y.jsx)(l.List,{navigationTitle:"Tasks",searchBarAccessory:(0,y.jsx)(K,{projects:i,onProjectChange:g}),children:r.length===0?(0,y.jsx)(l.List.EmptyView,{title:"No Tasks Found",description:"make sure you have added at least one task.",actions:(0,y.jsx)(l.ActionPanel,{children:(0,y.jsx)(l.Action.Push,{title:"Add a New Task",target:(0,y.jsx)($,{})},"newTask")})}):r.map(s=>(0,y.jsx)(l.List.Item,{id:s.uuid,keywords:[s.tags?[...s.tags].join(" "):"",s.project||""],title:s.description,accessories:[{text:s.project}],actions:(0,y.jsxs)(l.ActionPanel,{children:[(0,y.jsx)(l.Action.Push,{title:"Details",target:(0,y.jsx)(et,{task:s})},"Details"),(0,y.jsx)(l.Action,{title:"Mark as Done",onAction:()=>d(s.uuid)}),(0,y.jsx)(l.Action,{title:s.tags&&Array.from(s.tags).includes("next")?"Stop":"Start",shortcut:{modifiers:["ctrl"],key:"s"},onAction:()=>w(s)},"start"),(0,y.jsx)(l.Action,{title:"Delete",style:l.Action.Style.Destructive,shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>u(s.uuid)},"delete"),(0,y.jsx)(l.Action.Push,{title:"Add New Task",target:(0,y.jsx)($,{}),shortcut:{modifiers:["cmd"],key:"n"}},"new")]})},s.uuid))})},wt=Tt;
